<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lookups</title>
  <style>
    .active {
      font-weight: bold;
    }
    a {
      text-decoration: none;
      color: #333;
    }

    a._1 {
      margin-left: 0px;
    }

    a._2 {
      margin-left: 0px;
    }

    a._3 {
      margin-left: 0px;
    }

    a._4 {
      margin-left: 0px;
    }

    a._5 {
      margin-left: 20px;
    }

    a._6 {
      margin-left: 40px;
    }
  </style>
</head>

<body style="display:grid;">
    <ul style="grid-column: 1; list-style-type: none;">
    <li><a style="font-weight: bold" href="/"><---</a></li>
    
    
    <li><a class="_4" href="/developer/0-introduction/">Developer</a></li>
    
    
    
    <li><a class="_4" href="/developer/1-license/">License</a></li>
    
    
    
    <li><a class="_4" href="/developer/access/">Access</a></li>
    
    
    
    <li><a class="_5" href="/developer/access/0registration/">User Account Registration</a></li>
    
    
    
    <li><a class="_5" href="/developer/access/acl/">Access Control List (ACL)</a></li>
    
    
    
    <li><a class="_5" href="/developer/access/failed-login-attempts/">Failed Login attempts</a></li>
    
    
    
    <li><a class="_5" href="/developer/access/password-reset/">Password Reset</a></li>
    
    
    
    <li><a class="_5" href="/developer/environment_settings/3rd-party-api-keys/">3rd Party API Keys</a></li>
    
    
    
    <li><a class="_5" href="/developer/environment_settings/access-control/">Access Control</a></li>
    
    
    
    <li><a class="_5" href="/developer/environment_settings/environment-settings/">Environment Settings</a></li>
    
    
    
    <li><a class="_5" href="/developer/environment_settings/hosting/">Hosting</a></li>
    
    
    
    <li><a class="_5" href="/developer/environment_settings/workspace-connections/">Workspace Connections</a></li>
    
    
    
    
    
    <li><a class="_6" href="/developer/infoj/charts/cakeChart/">Cake charts</a></li>
    
    
    
    <li><a class="_6" href="/developer/infoj/charts/polarChart/">Polar charts</a></li>
    
    
    
    <li><a class="_6" href="/developer/infoj/charts/radarChart/">Radar charts</a></li>
    
    
    
    <li><a class="_6" href="/developer/infoj/charts/readme/">Introduction</a></li>
    
    
    
    <li><a class="_6" href="/developer/infoj/charts/simpleChart/">Simple charts</a></li>
    
    
    
    <li><a class="_6" href="/developer/infoj/charts/stackedChart/">Stacked charts</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/clusterArea/">Cluster Area</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/filter/">Filter</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/geometry/">Geometry</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/groups/">Groups</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/">InfoJ</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/isolines/">Isolines</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/locations/">Locations</a></li>
    
    
    
    <li class="active" ><a class="_5" href="/developer/infoj/lookups/">Lookups</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/orderedlist/">Ordered List</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/tabledefinition/">Table Definition</a></li>
    
    
    
    <li><a class="_5" href="/developer/infoj/withSelect/">With Select</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/charts/">Charts</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/cluster-layer/">Cluster Layer</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/filter/">Filter</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/geojson-layer/">GeoJson Layer</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/grid-hex/">Grid (Hex) Layer</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/">Layers</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/postgis-layer/">PostGIS Data Layer</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/tables/">Tables</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/tile-layer/">Tile Layer</a></li>
    
    
    
    <li><a class="_5" href="/developer/layers/vector-tile-mvt-layer/">MapBox Vector Tile (MVT) Layer</a></li>
    
    
    
    <li><a class="_5" href="/developer/locales/gazetteer/">Gazetteer</a></li>
    
    
    
    <li><a class="_5" href="/developer/locales/">Locales</a></li>
    
    
    
    <li><a class="_5" href="/developer/workspaces/access-restrictions/">Access Restrictions & Filters</a></li>
    
    
    
    <li><a class="_5" href="/developer/workspaces/editing/">Editing</a></li>
    
    
    
    <li><a class="_5" href="/developer/workspaces/locate/">Locate</a></li>
    
    
    
    <li><a class="_5" href="/developer/workspaces/title/">Title</a></li>
    
    
    
    <li><a class="_5" href="/developer/workspaces/workspace-checks/">Workspace Checks</a></li>
    
    
    
    <li><a class="_5" href="/developer/workspaces/">Workspaces</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
  
  <div  style="grid-column: 2;">
    <p>Lookups can be used to create aggregate values based on geometry checks.</p>
<p>The <a href="https://www.postgresql.org/docs/current/functions-aggregate.html">PostgreSQL <strong>aggregate</strong> </a> function is used for the aggregation of values which match the spatial lookup condition. The aggregate function will default to SUM. The aggregate function must be part of the function if <code>&quot;fieldfix&quot;:</code> is defined. If not defined the aggregate function must form part of the <code>&quot;lookup&quot;:</code></p>
<p>See examples below.</p>
<pre><code class="language-text">{
  &quot;label&quot;: &quot;OA pop_11&quot;,
  &quot;field&quot;: &quot;pop_11_&quot;,
  &quot;type&quot;: &quot;integer&quot;,
  &quot;lookup&quot;: {
    &quot;table_a&quot;: &quot;dev_polygons&quot;,
    &quot;geom_a&quot;: &quot;a.geom&quot;,
    &quot;table_b&quot;: &quot;schema.dev_points&quot;,
    &quot;geom_b&quot;: &quot;b.geomcntr&quot;,
    &quot;condition&quot;: &quot;ST_INTERSECTS&quot;,
    &quot;aggregate&quot;: &quot;AVG&quot;
  }
}
</code></pre>
<p><em>fig 1. (Look up that makes use of aggregate function)</em></p>
<pre><code class="language-text">{
  &quot;label&quot;: &quot;Population Growth % (2011-17)&quot;,
  &quot;field&quot;: &quot;pop_growth_11_17_5min&quot;,
  &quot;fieldfx&quot;: &quot;SUM(b.pop__17 - b.pop__11) * 100 / SUM(b.pop__11)&quot;,
  &quot;type&quot;: &quot;numeric&quot;,
  &quot;lookup&quot;: {
      &quot;table_a&quot;: &quot;schema.table_a&quot;,
      &quot;table_b&quot;: &quot;schema.table_b&quot;,
      &quot;geom_a&quot;: &quot;isoline_5min&quot;,
      &quot;geom_b&quot;: &quot;geomcntr&quot;
  }
}
</code></pre>
<p><em>fig 2. (Function field that overrides the aggregate)</em></p>
<p><strong>table_a</strong> must be the table which holds the location as defined by an ID in the lookup query.</p>
<p><strong>table_b</strong> must be in the same database but can be in a different schema.</p>
<p>Geometries must be fixed with a. or b. to prevent ambiguous lookups.</p>
<p><strong>geom_a</strong> can be translated to match the epsg of geom_b.</p>
<p><code>&quot;geom_a&quot;: &quot;ST_Transform(ST_Setsrid(a.geom, 4326), 3857)&quot;</code></p>
<p>It is highly recommended that <strong>geom_b</strong> has a spatial index.</p>
<p>The lookup <strong>condition</strong> must be a PostGIS function which takes the locations geometry as first input and the lookup geometry as the second input. The condition will default to <a href="https://postgis.net/docs/ST_Intersects.html">ST_Intersects</a>.</p>

  </div>
</body>

</html>